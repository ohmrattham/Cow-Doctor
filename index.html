<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üêÆ ‡∏´‡∏°‡∏≠‡∏ß‡∏±‡∏ß | ‡πÅ‡∏ä‡∏ó‡∏ö‡∏≠‡∏ó‡πÇ‡∏£‡∏Ñ‡∏ß‡∏±‡∏ß</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Reset & Base Styles */
    * {
      box-sizing: border-box;
      font-family: 'Kanit', sans-serif;
    }
    html, body {
     margin: 0;
     padding: 0;
     height: 100%;
     width: 100%;
     overflow: hidden; /* Prevent body scrollbar */
    }

    /* Splash Screen */
    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #66bb6a; /* Green background */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000; /* Ensure it's on top */
      transition: opacity 0.5s ease-out; /* Smooth fade out */
    }

    .splash-screen.hidden {
        opacity: 0;
        visibility: hidden;
    }

    .splash-screen img {
      width: 350px; /* Size of the cow icon */
      height: 350px;
      animation: bounce 1s infinite alternate; /* Simple bounce animation */
    }

    .splash-screen h1 {
        color: white;
        font-size: 2.5rem;
        margin-top: 20px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    @keyframes bounce {
      0% { transform: translateY(0); }
      100% { transform: translateY(-10px); }
    }

    /* Chat Wrapper */
    .chat-wrapper {
  display: none;
  flex-direction: column;
  height: 100vh;
  width: 100%;
}

.chat-wrapper.show {
  display: flex;
}

    /* Header */
    .header {
      background-color: #66bb6a;
      color: white;
      padding: 20px;
      font-size: 1.6rem;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: relative;
      z-index: 2;
    }

    /* Chat Box - Main message display area */
    .chat-box {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      background: #f9fbe7;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* Chat Rows - Container for each message (user or bot) */
    .chat-row {
      display: flex;
      align-items: flex-start;
      max-width: 100%;
    }
    .chat-row.user {
      justify-content: flex-end;
    }
    .chat-row.bot {
      flex-direction: row;
    }

    /* Chat Bubbles - The actual message bubble */
    .chat-bubble {
      max-width: 75%;
      padding: 12px 16px;
      border-radius: 18px;
      line-height: 1.5;
      word-wrap: break-word;
      font-size: 0.95rem;
      box-shadow: 0 1px 2px rgba(0,0,0,0.08);
    }
    .chat-bubble.user {
      background-color: #c8e6c9;
      color: #333;
      border-bottom-right-radius: 4px;
    }
    .chat-bubble.bot {
      background-color: #e0f2f1;
      color: #333;
      border-bottom-left-radius: 4px;
      margin-left: 10px;
    }

    /* Avatar */
    .avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    /* Chat Image within Bubble */
    .chat-image {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
      margin-top: 6px;
      display: block;
    }
    .chat-bubble.user .chat-image {
      margin-left: auto;
    }

    /* --- Form Input Area --- */
    form {
      position: relative;
      display: flex;
      padding: 12px 16px;
      border-top: 1px solid #eee;
      background: #f8f8f8;
      gap: 8px;
      align-items: center;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
      z-index: 1;
    }

    /* Input Wrapper for the text field and action icons */
    .input-wrapper {
      flex: 1;
      display: flex;
      flex-direction: row;
      align-items: center;
      border: 1px solid #ddd;
      border-radius: 25px;
      background: #fff;
      padding: 4px 8px;
      transition: border-color 0.2s, box-shadow 0.2s;
      position: relative;
    }
    .input-wrapper:focus-within {
      border-color: #4CAF50;
      box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
    }

    /* Adjust input and preview layout when image is present */
    .input-wrapper.has-image {
        flex-direction: column;
        padding-bottom: 8px;
        align-items: flex-start;
    }

    input[type="text"] {
      flex-grow: 1;
      padding: 8px 10px;
      border: none;
      outline: none;
      font-size: 1rem;
      background: transparent;
      min-height: 24px;
      width: 100%;
    }

    /* Action Buttons (inside the input wrapper) */
    .action-buttons-group {
        display: flex;
        gap: 4px;
        order: -1;
        padding-right: 8px;
    }
    .input-wrapper.has-image .action-buttons-group {
        order: 1;
        width: 100%;
        justify-content: flex-start;
        padding-right: 0;
    }


    .action-btn {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 20px;
      padding: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s;
      border-radius: 50%;
    }
    .action-btn:hover {
      color: #4CAF50;
      background-color: rgba(0,0,0,0.05);
    }
    .action-btn.file-upload {
      color: #8bc34a;
    }
    .action-btn.camera-capture {
      color: #ff9800;
    }

    /* Send Button (outside the input wrapper) */
    .send-btn {
      background: none;
      border: none;
      color: #4CAF50;
      cursor: pointer;
      font-size: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s, transform 0.2s;
      padding: 8px;
    }
    .send-btn:hover {
      color: #45a049;
      transform: scale(1.1);
    }
    .send-btn:active {
      transform: scale(1.0);
    }
    /* --- End Modified Form Input Area --- */

    /* Hidden File Inputs */
    #imageInputFile, #imageInputCamera {
      display: none;
    }

    /* Image Preview Overlay - NOW INSIDE input-wrapper */
    .preview-overlay {
      display: none;
      flex-direction: row;
      align-items: center;
      padding: 8px;
      border-radius: 12px;
      background: #f0f0f0;
      margin-top: 4px;
      width: 100%;
      position: relative;
      box-shadow: inset 0 0 3px rgba(0,0,0,0.1);
    }
    .preview-overlay img {
      max-width: 60px;
      max-height: 60px;
      border-radius: 8px;
      object-fit: cover;
      flex-shrink: 0;
    }
    .preview-overlay button {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #f44336;
      border: 1px solid white;
      color: white;
      font-size: 14px;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .preview-overlay p {
        margin: 0;
        padding-left: 10px;
        color: #555;
        font-size: 0.9rem;
    }

    /* Typing Indicator (for bot response pending) */
    .typing-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 10px;
      margin-top: 5px;
      padding: 8px 12px;
      background-color: #e0f2f1;
      border-radius: 18px;
      max-width: fit-content;
      font-size: 0.9rem;
      color: #555;
    }
    .typing-indicator span {
      animation: blink 1.2s infinite;
      font-size: 1.5em;
      line-height: 0;
    }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes blink {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body>

  <div class="splash-screen" id="splashScreen">
    <img src="icon.png" alt="‡∏´‡∏°‡∏≠‡∏ß‡∏±‡∏ß‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô" />
    <h1>‡∏´‡∏°‡∏≠‡∏ß‡∏±‡∏ß</h1>
    <p style="color:white; font-size:1.2rem; margin-top:10px;"></p>
  </div>

  <div class="chat-wrapper" id="chatWrapper">
    <div class="header">üêÆ ‡∏´‡∏°‡∏≠‡∏ß‡∏±‡∏ß </div>
    <div class="chat-box" id="chatBox"></div>

    <form id="chatForm">
      <div class="input-wrapper" id="inputWrapper">
        <div class="action-buttons-group">
          <label for="imageInputFile" class="action-btn file-upload" title="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå">‚ûï</label>
          <input type="file" accept="image/*" id="imageInputFile" />

          <label for="imageInputCamera" class="action-btn camera-capture" title="‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á">üì∏</label>
          <input type="file" accept="image/*" id="imageInputCamera" capture="environment" />
        </div>

        <div class="preview-overlay" id="previewOverlay">
          <img id="previewImage" alt="‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏†‡∏≤‡∏û" />
          <p id="previewFileName"></p>
          <button type="button" onclick="clearPreview()" title="‡∏•‡∏ö‡∏†‡∏≤‡∏û">‚úñ</button>
        </div>
        
        <input type="text" id="userInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û..." autocomplete="off" />
      </div>
      
      <button type="submit" class="send-btn" title="‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°">‚û§</button>
    </form>
  </div>

  <script>
    // ** IMPORTANT: Replace 'YOUR_GEMINI_API_KEY' with your actual API Key.
    // ** WARNING: Directly embedding API Keys in frontend code is INSECURE for production.
    // ** It is highly recommended to use a backend server to proxy API calls and store your API Key securely.
    const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY'; 

    const splashScreen = document.getElementById('splashScreen');
    const chatWrapper = document.getElementById('chatWrapper');
    const form = document.getElementById('chatForm');
    const chatBox = document.getElementById('chatBox');
    const input = document.getElementById('userInput');
    
    const imageInputFile = document.getElementById('imageInputFile');
    const imageInputCamera = document.getElementById('imageInputCamera');
    
    const inputWrapper = document.getElementById('inputWrapper');
    const previewOverlay = document.getElementById('previewOverlay');
    const previewImage = document.getElementById('previewImage');
    const previewFileName = document.getElementById('previewFileName');

    let pendingImageData = null;
    let pendingImageFile = null;

    const chatHistory = []; 
    let typingIndicatorElement = null;

    // Function to handle the splash screen transition
    function showChatAfterSplash() {
        // Add hidden class to splash screen to trigger fade out
        splashScreen.classList.add('hidden');
        // After fade out, hide it completely and show chat wrapper
        setTimeout(() => {
            splashScreen.style.display = 'none';
            chatWrapper.style.display = 'flex'; // Show the chat wrapper
            // Initial greeting message when the page loads
            appendMessage('bot', { type: 'text', content: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö **‡∏ú‡∏°‡∏´‡∏°‡∏≠‡∏ß‡∏±‡∏ß** ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ß‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?' });
        }, 500); // This timeout should match the CSS transition duration
    }

    // Call the transition function when the page is fully loaded
    window.addEventListener('load', () => {
        setTimeout(showChatAfterSplash, 2000); // Show splash for 2 seconds
    });


    // Event listener for form submission (sending message/image)
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const text = input.value.trim();
      const hasText = text.length > 0;
      const hasImage = !!pendingImageData;

      if (!hasText && !hasImage) return;

      if (hasText) {
        appendMessage('user', { type: 'text', content: text });
      }
      if (hasImage) {
        appendMessage('user', { type: 'image', content: pendingImageData });
      }

      input.value = '';
      clearPreview(); 

      showTypingIndicator();
      
      try {
        const requestParts = [];
        if (hasText) {
          requestParts.push({ text: text });
        }
        if (hasImage) {
          const base64Image = pendingImageData.split(',')[1]; 
          requestParts.push({
            inlineData: {
              mimeType: pendingImageFile.type,
              data: base64Image
            }
          });
        }
        
        chatHistory.push({ role: 'user', parts: requestParts });

        const model = hasImage ? 'gemini-pro-vision' : 'gemini-pro';

        const geminiResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${GEMINI_API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: chatHistory,
            safetySettings: [
              { category: 'HARM_CATEGORY_HARASSMENT', threshold: 'BLOCK_NONE' },
              { category: 'HARM_CATEGORY_HATE_SPEECH', threshold: 'BLOCK_NONE' },
              { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: 'BLOCK_NONE' },
              { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_NONE' },
            ]
          })
        });

        const geminiData = await geminiResponse.json();
        
        hideTypingIndicator();

        if (geminiData.candidates && geminiData.candidates[0] && geminiData.candidates[0].content && geminiData.candidates[0].content.parts) {
          const botReply = geminiData.candidates[0].content.parts.map(part => part.text).join('\n');
          appendMessage('bot', { type: 'text', content: botReply });
          chatHistory.push({ role: 'model', parts: [{ text: botReply }] });
        } else if (geminiData.promptFeedback && geminiData.promptFeedback.blockReason) {
            appendMessage('bot', { type: 'text', content: '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ï‡∏≤‡∏°‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á AI' });
        } else {
            appendMessage('bot', { type: 'text', content: '‚ö†Ô∏è ‡∏´‡∏°‡∏≠‡∏ß‡∏±‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á' });
            console.error('Gemini API Error:', geminiData);
        }

      } catch (err) {
        hideTypingIndicator();
        appendMessage('bot', { type: 'text', content: '‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏°‡∏≠‡∏ß‡∏±‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á' });
        console.error('Fetch Error:', err);
      }
    });

    imageInputFile.addEventListener('change', (event) => {
      handleImageSelection(event.target.files[0]);
    });

    imageInputCamera.addEventListener('change', (event) => {
      handleImageSelection(event.target.files[0]);
    });

    function handleImageSelection(file) {
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
        imageInputFile.value = '';
        imageInputCamera.value = '';
        return;
      }
      
      pendingImageFile = file;
      const reader = new FileReader();
      reader.onload = () => {
        pendingImageData = reader.result;
        previewImage.src = reader.result;
        previewFileName.textContent = file.name;
        
        previewOverlay.style.display = 'flex';
        inputWrapper.classList.add('has-image');
        input.placeholder = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...';
        input.focus();
      };
      reader.readAsDataURL(file);
    }

    function clearPreview() {
      previewOverlay.style.display = 'none';
      previewImage.src = '';
      previewFileName.textContent = '';
      pendingImageData = null;
      pendingImageFile = null;
      inputWrapper.classList.remove('has-image');
      input.placeholder = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ß...';
      imageInputFile.value = ''; 
      imageInputCamera.value = '';
    }

    function appendMessage(sender, message) {
      const row = document.createElement('div');
      row.className = `chat-row ${sender}`;

      if (sender === 'bot') {
        const avatar = document.createElement('img');
        avatar.src = 'icon.png';
        avatar.alt = '‡∏´‡∏°‡∏≠‡∏ß‡∏±‡∏ß';
        avatar.className = 'avatar';
        row.appendChild(avatar);
      }

      const bubble = document.createElement('div');
      bubble.className = `chat-bubble ${sender}`;

      if (message.type === 'text') {
        bubble.innerHTML = formatText(message.content);
      } else if (message.type === 'image') {
        const img = document.createElement('img');
        img.src = message.content;
        img.className = 'chat-image';
        bubble.appendChild(img);
      }

      row.appendChild(bubble);
      chatBox.appendChild(row);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function formatText(text) {
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
        text = text.split('\n').map(line => {
            if (line.startsWith('- ')) {
                return `<li>${line.substring(2)}</li>`;
            }
            return line;
        }).join('\n');
        if (text.includes('<li>')) {
            text = `<ul>${text}</ul>`;
        }
        text = text.replace(/\n/g, '<br>');
        return text;
    }

    function showTypingIndicator() {
      if (typingIndicatorElement) {
        hideTypingIndicator();
      }
      const row = document.createElement('div');
      row.className = 'chat-row bot';
      
      const avatar = document.createElement('img');
      avatar.src = 'icon.png'; 
      avatar.alt = '‡∏´‡∏°‡∏≠‡∏ß‡∏±‡∏ß';
      avatar.className = 'avatar';
      row.appendChild(avatar);

      typingIndicatorElement = document.createElement('div');
      typingIndicatorElement.className = 'typing-indicator chat-bubble bot';
      typingIndicatorElement.innerHTML = '<span>.</span><span>.</span><span>.</span>';
      
      row.appendChild(typingIndicatorElement);
      chatBox.appendChild(row);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function hideTypingIndicator() {
      if (typingIndicatorElement && typingIndicatorElement.parentNode) {
        const parentRow = typingIndicatorElement.closest('.chat-row');
        if (parentRow) {
            chatBox.removeChild(parentRow);
        }
        typingIndicatorElement = null;
      }
    }
  </script>

</body>
</html>
